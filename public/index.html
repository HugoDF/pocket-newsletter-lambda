<!doctype html>
<html lang="">

<head>
  <meta charset="utf-8">
  <title>Pocket Newsletter Generator Lambda</title>
  <meta name="description" content="Pocket Newsletter Generator Lambda">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <meta name="theme-color" content="#f56565">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <div class="container">
    <h1 class="font-semibold">Pocker Newsletter Lambda demo</h1>
    <p>You'll need a Pocket API Consumer Key and Access Token.</p>
    <p>For a walthrough of how to get them, see <a href="https://pocket-personal-access-token.glitch.me/">https://pocket-personal-access-token.glitch.me/</a></p>
    <p>The lambda loads all (archived and not archived) Pocket posts tagged with "newsletter".</p>
    <div class="flex justify-center">
      <form class="w-full max-w-sm" action="/.netlify/functions/newsletter" method="post">
        <div class="md:flex md:items-center mb-6">
          <div class="md:w-1/3">
            <label class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" for="consumer_key">
              Pocket Consumer Key
            </label>
          </div>
          <div class="md:w-2/3">
            <input
              required="required"
              class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-red-500"
              id="consumer_key"
              name="pocket_consumer_key"
              type="text">
          </div>
        </div>
        <div class="md:flex md:items-center mb-6">
          <div class="md:w-1/3">
            <label class="block text-gray-500 font-bold md:text-right mb-1 md:mb-0 pr-4" for="access_token">
              Pocket Access Token
            </label>
          </div>
          <div class="md:w-2/3">
            <input
              required="required"
              class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-red-500"
              id="access_token"
              type="text"
              name="pocket_access_token"
              >
          </div>
        </div>
        <div class="md:flex md:items-center">
          <div class="md:w-1/3"></div>
          <div class="md:w-2/3">
            <button
              class="shadow bg-red-500 hover:bg-red-400 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4 rounded"
              type="submit">
              Try it!
            </button>
          </div>
        </div>
      </form>
    </div>

    <h2 class="font-medium">Response:</h2>

    <div>
      <code>
        <pre id="response-area">
        </pre>
      </code>
    </div>
  </div>

  <script>
    (function () {
      function getFieldValue(form, field) {
        return form[field].value
      }
      const form = document.querySelector('form[method="post"]');
      const responseArea = document.querySelector('#response-area');
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const data = {
          pocket_consumer_key: getFieldValue(form, 'pocket_consumer_key'),
          pocket_access_token: getFieldValue(form, 'pocket_access_token'),
        };
        const url = form.action;
        const verb = (form.method || 'post').toUpperCase();
        fetch(url, {
          method: verb,
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        }).then(function (res) {
          if(res.ok) {
            return res.json();
          }
          throw new Error('Network response was not ok.');
        }).then(function(jsonResponse) {
          responseArea.innerText = JSON.stringify(jsonResponse, null, 2);
        }).catch(function (error) {
          responseArea.innerText = error.message
        })
      })
    })()
  </script>
</body>

</html>
